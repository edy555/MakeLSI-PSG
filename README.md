MakeLSI 2016 PSG:方形波音源
==============================

# 概要

MakeLSIに載せてもらうための、単音を出すことを目的にした音源のLSIデザイ
ンです。分数分周器(フラクショナルディバイダ)を純正律に従った分周比に設
定し、デジタル入力で音程を選択することで、周波数を切り替えて出力します。
音として聞くため、圧電素子をチップに接続することを想定しています。

MakeLSI 2016への相乗りチップ設計参加プロジェクトです。[公式サイト](http://ifdl.jp/make_lsi/index.php)

# 方針

* 昨年度(MakeLSI 2015)で動作成功したRingVCOを発振源として使用する
* RingVCOで発振させたMHz帯の信号を多段のFFで分周し可聴域の周波数に落とす
* 分数分周器を使用し純正律に従った音程を生成する
* あらかじめ用意されているスタンダードセルを使用する
* 分数分周器は4ビット非同期カウンタで実装する

純正律は周波数比がシンプルな整数比で構成されている。これに対して、一般
的な平均律では半音毎に2^(1/12)の周波数比を持ち簡単な整数比になっていない。
今回は、小さな回路規模の分数分周器で音程を生成させるために純正律を選択。

純正律 [Wikipedia](https://ja.wikipedia.org/wiki/%E7%B4%94%E6%AD%A3%E5%BE%8B)

|Note|C|D|E|F|G|A|B|C(+1)|
|----|-|-|-|-|-|-|-|-|
|Ratio|1/1|9/8|5/4|4/3|3/2|5/3|15/8|2/1|

# 仕様

|項目|内容|
|---|------|
|音程|全音7音|
|範囲|2オクターブ(オクターブ選択)|
|基本ピッチ設定|アナログ電圧0-5V|
|分周段数|14段=1/2^14|
|電源電圧|5V|

# インターフェース

|端子|内容|
|-----|---|
|Vc|VCO制御電圧|
|OSC|VCO出力(5~30MHz)|
|C|音程選択C|
|D|音程選択D|
|E|音程選択E|
|F|音程選択F|
|G|音程選択G|
|A|音程選択A|
|B|音程選択B|
|C1|音程選択C1(オクターブ上のC)|
|SEL|オクターブ選択|
|OUT|方形波出力(100~2000Hz)|
|Vdd|5V|
|GND|GND|

# レイアウト

![レイアウト図](https://raw.githubusercontent.com/edy555/MakeLSI-PSG/doc/PSG7.png)

# 手順

## ツールを入手

wgex.exeを入手する。MakeLSIのMLへの参加が必要です。
Windows用のツールですが、OSXのVMware上でWinXPから使用しました。

## 開く

gitからファイルを取得(clone)します。

   $ git clone git://github.com/edy555/MakeLSI-PSG.git

wgex.exeを起動し、PSG7.gexを開きます。


## DRC

DRC(Design Rule Check)して、レイアウトが制約に適合しているかを確認しま
す。

TBW

## シミュレーションする

レイアウトから回路抽出をして、LTspiceでシミュレーションします。

シミュレーションで電圧を参照しやすくするため、.CEXファイルのノード番号
をスクリプトでリナンバリングします。

   $ ruby cexrenum.rb PSG7.cex > xxx.sp

さらに適宜以下を行います。

* 途中にある.endの行を削除する
* 電源電圧を与える指定を追加します
* 入力ピンの電圧を適切に与える指定を追加します
* ノード番号は、ファイル中から信号名等を検索して探し出します 

このようにして作成した.spファイルをLTspiceで開きます。Runボタンを押し
てシミュレーションを開始します。

波形ウィンドウが開いたら、追加ボタンを押して、観測する信号をV(ノード番
号)の形式で指定します。


# 設計検討とシミュレーション

検討と設計とシミュレーションの過程のメモです。

TBW


# クレジット

Author: @edy555
